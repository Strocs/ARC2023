---
import Layout from '../layouts/Layout.astro'
import { ARC_2023 } from '../data/ARC_2023'
import Map from '../components/Map.astro'
import LocationInfo from '../components/LocationInfo.astro'
import Controls from '../components/Controls.astro'
import Header from '../components/Header.astro'
import Footer from '../components/Footer.astro'
const { title, description, locations } = ARC_2023
---

<Layout title={title} description={description}>
	<Header />
	<main id='main-page' class='relative w-full h-auto overflow-hidden'>
		{locations.map((location) => <LocationInfo query={location.id} />)}
		<Map />
		<Controls />
	</main>
	<Footer fixed />
</Layout>

<script>
	const mapIcon = document.getElementById('map').querySelectorAll('.names')
	const locations = document.querySelectorAll('[aria-label="location-info"]')
	const header = document.querySelector('header').querySelector('div')
	const scheduleBtn = document.querySelector('header').querySelector('span')
	const footer = document.querySelector('footer')
	const logo = document.getElementById('logo-text')
	const buttons = header.querySelector('button')
	const links = header.querySelectorAll('#social-networks')
	const controls = document.querySelector('#controls')

	console.log(scheduleBtn);

	const colors = [
		{
			textColor: 'text-pale-purple',
			fillColor: 'fill-pale-purple',
			bgColor: 'bg-pale-purple',
			hoverColor: 'hover:text-pale-purple'
		},
		{
			textColor: 'text-orange',
			fillColor: 'fill-orange',
			bgColor: 'bg-orange',
			hoverColor: 'hover:text-orange'
		},
		{
			textColor: 'text-black-pink',
			fillColor: 'fill-black-pink',
			bgColor: 'bg-black-pink',
			hoverColor: 'hover:text-black-pink'
		},
		{
			textColor: 'text-purple',
			fillColor: 'fill-purple',
			bgColor: 'bg-purple',
			hoverColor: 'hover:text-purple'
		},
		{
			textColor: 'text-pink',
			fillColor: 'fill-pink',
			bgColor: 'bg-pink',
			hoverColor: 'hover:text-pink'
		},
		{
			textColor: 'text-yellow',
			fillColor: 'fill-yellow',
			bgColor: 'bg-yellow',
			hoverColor: 'hover:text-yellow'
		},
		{
			textColor: 'text-blue',
			fillColor: 'fill-blue',
			bgColor: 'bg-blue',
			hoverColor: 'hover:text-blue'
		},
		{
			textColor: 'text-red',
			fillColor: 'fill-red',
			bgColor: 'bg-red',
			hoverColor: 'hover:text-red'
		},
		{
			textColor: 'text-pale-blue',
			fillColor: 'fill-pale-blue',
			bgColor: 'bg-pale-blue',
			hoverColor: 'hover:text-pale-blue'
		}
	]

	function showLocationsInfo(element, show, index) {
		if (show) {
			header.classList.add(colors[index].bgColor)
			footer.classList.add(colors[index].bgColor)
			scheduleBtn.classList.add(colors[index].bgColor)
			controls.classList.add(colors[index].bgColor)
			logo.classList.add(colors[index].fillColor)
			buttons.classList.add(colors[index].textColor)
			links.forEach((link) => {
				link.classList.remove('hover:text-main')
				link.classList.add(colors[index].hoverColor)
			})
			element.style.right = '0'
			element.style.zIndex = '20'
			element.style.opacity = '1'
		} else {
			header.classList.remove(colors[index].bgColor)
			footer.classList.remove(colors[index].bgColor)
			scheduleBtn.classList.remove(colors[index].bgColor)
			controls.classList.remove(colors[index].bgColor)
			logo.classList.remove(colors[index].fillColor)
			buttons.classList.remove(colors[index].textColor)
			links.forEach((link) => {
				link.classList.remove(colors[index].hoverColor)
				link.classList.add('hover:text-main')
			})
			element.style.zIndex = '10'
			element.style.right = '-448px'
		}
	}

	mapIcon.forEach((icon, index) =>
		icon.addEventListener('click', () => {
			locations.forEach((location, index) => {
				showLocationsInfo(location, false, index)
			})
			showLocationsInfo(locations[index], true, index)
		})
	)

	mapIcon.forEach((icon, index) =>
		icon.addEventListener('touchend', () => {
			locations.forEach((location) => {
				showLocationsInfo(location, false, index)
			})
			showLocationsInfo(locations[index], true, index)
		})
	)

	locations.forEach((location, index) => {
		location.addEventListener(
			'transitionend',
			(e) => {
				if (location !== e.target) return
				if (location.style.right === '-448px') {
					location.style.opacity = '0'
				}
			},
			false
		)
		location.querySelector('button').addEventListener('click', () => {
			showLocationsInfo(location, false, index)
		})
	})
</script>
